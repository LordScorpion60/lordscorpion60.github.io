<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- HTML Meta Tags -->
    <title>LordScorpion60's Domain - FSX Play Scorecards</title>
    <meta name="description" content="">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://lordscorpion60.github.io/foresight_sports/fsx_play_courses.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="LordScorpion60's Domain - FSX Play Scorecards">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://ogcdn.net/6064b869-74ed-4eb9-b76c-0b701ffe7e6b/v4/lordscorpion60.github.io/%5B%20LordScorpion60's%20Domain%20%5D%20FSX%20Play%20Scorecards/https%3A%2F%2Fopengraph.b-cdn.net%2Fproduction%2Fimages%2Ffa506cf3-1f23-44d9-aa2a-12b830eeaa9d.jpg%3Ftoken%3DUTJ_Ar12acqND3QxxCIsz2b80IzxN2SHbkvjihBaWuo%26height%3D763%26width%3D1018%26expires%3D33253712874/og.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="lordscorpion60.github.io">
    <meta property="twitter:url" content="https://lordscorpion60.github.io/foresight_sports/fsx_play_courses.html">
    <meta name="twitter:title" content="LordScorpion60's Domain - FSX Play Scorecards">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://ogcdn.net/6064b869-74ed-4eb9-b76c-0b701ffe7e6b/v4/lordscorpion60.github.io/%5B%20LordScorpion60's%20Domain%20%5D%20FSX%20Play%20Scorecards/https%3A%2F%2Fopengraph.b-cdn.net%2Fproduction%2Fimages%2Ffa506cf3-1f23-44d9-aa2a-12b830eeaa9d.jpg%3Ftoken%3DUTJ_Ar12acqND3QxxCIsz2b80IzxN2SHbkvjihBaWuo%26height%3D763%26width%3D1018%26expires%3D33253712874/og.png">

    <!-- Meta Tags Generated via https://www.opengraph.xyz -->
    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <!--<link href="/css/plugins/metisMenu/metisMenu.min.css" rel="stylesheet">-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/metismenu/dist/metisMenu.min.css">

    <!-- Custom CSS -->
    <link href="/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
        div.sticky {
            position: -webkit-sticky; /* Safari */
            position: sticky;
            top: 10px;
            margin-top: 10px;
        }

        /* width */
        ::-webkit-scrollbar {
            width: 25px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #428bca;
            border-radius: 8px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: grey;
        }

        input[type='checkbox'] {
            width: 20px;
            height: 20px;
            background: white;
            vertical-align: middle;
            bottom: 3px;
            position: relative;
        }
    </style>
</head>

<body>
    <div id="wrapper">
        <!-- Navigation -->
        <div id="nav-placeholder">
            <!-- Leave blank so page content loads too -->
        </div>
        <!-- end of Navigation -->
        <!-- Page Content -->
        <div id="page-wrapper">
            <div class="row">
                <div class="col-xs-12">
                    <h1 class="page-header">FSX Play Scorecards</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel-group" id="accordion">
                        <div class="panel panel-danger" style="display:none">
                            <div class="panel-heading">
                                Disclaimer <i class="fa fa-exclamation-circle"></i>
                            </div>
                            <div class="panel-body">
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum tincidunt est vitae ultrices accumsan. Aliquam ornare lacus adipiscing, posuere lectus et, fringilla augue.</p>
                            </div>
                        </div>
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#accordionInfo" href="#collapseInfo">Info <i class="fa fa-info-circle"></i></a>
                                </h4>
                            </div>
                            <div id="collapseInfo" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <p>The following is my repository of scorecards collected from each <a href="https://www.foresightsports.com/collections/fsx-courses" target="_blank">Foresight Sports FSX Play course <i class="fa fa-external-link fa-fw"></i></a> to provide specific search capabilities in order to learn more about the courses you own, are looking to buy, or want to share with a friend.</p>
                                    <p>Each scorecard will have a link to where you can purchase the course, some will have a link to watch a flyover video to learn more about how the course looks in FSX Play.</p>
                                    <p>Be sure to check the Notifications Panel on the <a href="/">home page</a> for updates and new features!</p>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#accordionClub" href="#collapseClub">Club Data <i class="fa fa-crosshairs"></i></a>
                                </h4>
                            </div>
                            <div id="collapseClub" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <p>Enter your carry for each club at sea level (0 ft.) and each selected course will show the adjusted carry for altitude.</p>
                                    <label style="text-align: center">
                                        Driver <input id="clubDataDriver" class="form-control" style="text-align: center; width: 75px;">
                                    </label>
                                    <label style="text-align: center">&nbsp;</label>
                                    <label style="text-align: center">
                                        7 Iron<input id="clubData7Iron" class="form-control" style="text-align: center; width: 75px;">
                                    </label>
                                    <label style="text-align: center">&nbsp;</label>
                                    <label style="text-align: center">
                                        Wedge<input id="clubDataWedge" class="form-control" style="text-align: center; width: 75px;">
                                    </label>
                                    &nbsp;&nbsp;<button id="btnSaveClubData" class="btn btn-info" type="button" data-container="body" data-toggle="popover" data-placement="right" data-content="Club data saved" onclick="saveClubData()">Save</button>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#accordionSearch" href="#collapseSearch">Course Search <i class="fa fa-search"></i></a>
                                </h4>
                            </div>
                            <div id="collapseSearch" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Course Name</span>
                                        <span class="input-group-btn" style="width: 105px;">
                                            <select class="form-control" id="ddlNameSearchOperator">
                                                <option>Contains</option>
                                                <option>Equals</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtNameSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Version</span>
                                        <input type="text" class="form-control" placeholder="" id="txtVersionSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Par</span>
                                        <select class="form-control" id="ddlParSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon tooltip-search">Slope <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="bottom" title="Has at least one teebox that has..."></i></span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlSlopeSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtSlopeSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon tooltip-search">Rating <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="bottom" title="Has at least one teebox that has..."></i></span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlRatingSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtRatingSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon tooltip-search">Yardage <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="bottom" title="Has at least one teebox that has..."></i></span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlYardageSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtYardageSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Altitude</span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlAltSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                                <option>=</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtAltitudeSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Type</span>
                                        <select class="form-control" id="ddlTypeSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">City</span>
                                        <select class="form-control" id="ddlCitySearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Country</span>
                                        <select class="form-control" id="ddlCountrySearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Continent</span>
                                        <select class="form-control" id="ddlContinentSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">State</span>
                                        <select class="form-control" id="ddlStateSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            Has Flyover Video <input type="checkbox" id="chkHasFlyoverVideo">
                                        </div>
                                    </div>
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            Is Favorite <input type="checkbox" id="chkIsFavorite">
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-footer small">
                                    <button id="btnSearchCourseName" class="btn btn-info" type="button" onclick="SearchCourse()">
                                        Search
                                    </button>
                                    <button id="btnSearchCourseName" class="btn btn-warning" type="button" data-container="body" data-toggle="popover" data-placement="right" data-content="Search Filters Reset" onclick="SearchCourseReset()">
                                        Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-md-8">
                    <h4 id="courseResultCount">Courses loaded</h4>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-4 col-md-4" id="courseList" style="height: 900px; overflow-y: auto; overflow-x:hidden;">
                    <!-- Built on load -->
                </div>
                <div class="col-xs-8 col-md-8">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <i class="fa fa-arrow-left"></i> Click on a course to load it's scorecard here <i class="fa fa-arrow-down"></i>
                        </div>
                        <div class="panel-body" id="course-placeholder">
                            <!-- Leave blank so course content loads -->
                        </div>
                        <div class="panel-footer" id="courseFooter" style="display:none">
                            <table width="100%">
                                <tr>
                                    <td align="left">
                                        <a class="btn btn-outline btn-primary" data-container="body" data-toggle="popover" data-placement="top" data-content="Link copied to clipboard" onclick="clipboardCopy()">
                                            Share Course <i class="fa fa-share-alt"></i>
                                        </a>
                                        <span class="tooltip-search">
                                            <button class="btn btn-outline btn-primary" id="courseFavorite" onclick="MarkCourseFavorite()" data-toggle="tooltip" data-placement="top" title="Choice will persist on your next visit">Favorite <i id="courseFavoriteStar" class="fa fa-star-o"></i></button>
                                        </span>
                                        <a class="btn btn-outline btn-primary" id="courseBuyLink" href="#" style="display:none" target="_blank">Buy Course <i class="fa fa-shopping-cart"></i></a>
                                        <a class="btn btn-outline btn-primary" id="courseFlyoverLink" href="#" style="display:none" target="_blank">Watch Flyover Video <i class="fa fa-video-camera"></i></a>
                                        <button class="btn btn-outline btn-primary" id="courseRequestFlyover" data-container="body" data-toggle="popover" data-placement="top" data-content="Request sent!" style="display:none" onclick="requestFlyOverVideo()">Request Flyover Video <i class="fa fa-bullhorn"></i></button>
                                    </td>
                                    <td align="right">
                                        <div style="display: none; vertical-align: middle;" id="clubDataAltAdj">
                                            <button type="button" id="btnAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8;"><b>Alt Gain:</b> <span id="courseAltAdj"></span></button>
                                            <button type="button" id="btnDriverAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8; display:none;"><b>D:</b> <span id="clubDriverAltAdj"></span></button>
                                            <button type="button" id="btn7IronAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8; display: none;"><b>7i:</b> <span id="club7IronAltAdj"></span></button>
                                            <button type="button" id="btnWedgeAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8; display: none;"><b>W:</b> <span id="clubWedgeAltAdj"></span></button>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <!--<script src="/js/plugins/metisMenu/metisMenu.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/metismenu"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/sb-admin-2.js"></script>

    <script>

        // Variable to hold course information
        var documentTitle = document.title;
        var courseArr = {};
        var courseMediaArr = {};
        var userInfo = "[NO_IP]";

        $("[data-toggle=popover]").popover({
            delay: {
                show: 100,
                hide: 100
            }
        });

        $('.tooltip-search').tooltip({
            selector: "[data-toggle=tooltip]",
            container: "body"
        })

        $("[data-toggle=popover]").on('shown.bs.popover', function () {
            setTimeout(function (a) {
                a.popover('hide');
            }, 1500, $(this));
        });

        // Wire up keyboard enter key for course searching
        $("#txtNameSearch").on('keypress', function (event) {
            if (event.which === 13) {
                SearchCourse();
            }
        });

        $("#txtVersionSearch").on('keypress', function (event) {
            if (event.which === 13) {
                SearchCourse();
            }
        });

        $("#txtAltitudeSearch").on('keypress', function (event) {
            if (event.which === 13) {
                SearchCourse();
            }
        });

        $("#txtSlopeSearch").on('keypress', function (event) {
            if (event.which === 13) {
                SearchCourse();
            }
        });

        $("#txtRatingSearch").on('keypress', function (event) {
            if (event.which === 13) {
                SearchCourse();
            }
        });

        $("#txtYardageSearch").on('keypress', function (event) {
            if (event.which === 13) {
                SearchCourse();
            }
        });

        // On page-load.
        $(function () {
            $("#nav-placeholder").load("/nav.html");

            // Check QS params when page loads in case we got a course to load up
            const queryParams = new URLSearchParams(window.location.search);
            const queryCourse = queryParams.get('course');

            // Read in json course data
            $.getJSON("/foresight_sports/fsx_play_courses/zz_allCourseData.json").done(function (data) {
                window.courseArr = data;
                console.log('course json loaded...');
                //console.log(window.courseArr);
                if (window.courseArr.length > 0) {
                    loadSearchDropdowns();
                    $("#courseResultCount").html("Courses found: " + window.courseArr.length);
                }

                // Read in json course media data
                $.getJSON("/foresight_sports/fsx_play_courses/aa_allCourseMediaData.json").done(function (data) {
                    window.courseMediaArr = data;
                    console.log('course media json loaded...');

                    if (queryCourse != null) {
                        loadScoreCard(queryCourse);
                    }
                }).fail(function (data) {
                    console.warn('no course media data found!');
                });

            }).fail(function (data) {
                console.warn('no course data found!');
            });
            
            GetUserData();
            LoadClubData();
        });

        async function GetUserData() {
            try {
                var request1 = await fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        window.userInfo = "[" + data.ip + "]";

                        $.getJSON("https://ipinfo.io/json?token=e96ec5b44f0930").done(function (data) {
                            window.userInfo = "[" + jsonResponse.ip + ":" + jsonResponse.city + ":" + jsonResponse.country + ":" + jsonResponse.postal + "]";
                        }).fail(function (data) {
                            console.warn('no extra user data could be loaded!');
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching IP:', error);
                    });
            }
            catch {
                console.warn("could not get user IP...");
            }

            console.log(window.userInfo);
        }

        function LoadClubData() {
            var clubDriver = LocalStorage('get', "clubData_Driver");
            var club7Iron = LocalStorage('get', "clubData_7Iron");
            var clubWedge = LocalStorage('get', "clubData_Wedge");

            if (clubDriver != null) {
                $('#clubDataDriver').val(clubDriver);
            }

            if (club7Iron != null) {
                $('#clubData7Iron').val(club7Iron);
            }

            if (clubWedge != null) {
                $('#clubDataWedge').val(clubWedge);
            }
        }

        function saveClubData() {
            var clubDriver = $('#clubDataDriver').val();
            var club7Iron = $('#clubData7Iron').val();
            var clubWedge = $('#clubDataWedge').val();
            var errMsg = "";
            var finalMsg = "";

            var regex = /^[0-9]+$/;

            if (!clubDriver.match(regex) || Number(clubDriver) == 0 || Number(clubDriver) > 999) {
                if (clubDriver.length == 0) {
                    LocalStorage('remove', "clubData_Driver");
                }
                else {
                    errMsg = "Use a number (1-999) for Driver";
                }
            }
            else {
                LocalStorage('set', "clubData_Driver", clubDriver);
            }

            if (!club7Iron.match(regex) || Number(club7Iron) == 0 || Number(club7Iron) > 999) {
                if (club7Iron.length == 0) {
                    LocalStorage('remove', "clubData_7Iron");
                }
                else {
                    if (errMsg.length == 0) {
                        errMsg = "Use a number (1-999) for 7 Iron";
                    }
                    else {
                        errMsg += " & 7 Iron";
                    }
                }
            }
            else {
                LocalStorage('set', "clubData_7Iron", club7Iron);
            }

            if (!clubWedge.match(regex) || Number(clubWedge) == 0 || Number(clubWedge) > 999) {
                if (clubWedge.length == 0) {
                    LocalStorage('remove', "clubData_Wedge");
                }
                else {
                    if (errMsg.length == 0) {
                        errMsg = "Use a number (1-999) for Wedge";
                    }
                    else {
                        errMsg += " & Wedge";
                    }
                }
            }
            else {
                LocalStorage('set', "clubData_Wedge", clubWedge);
            }

            if (errMsg.length > 0) {
                finalMsg = errMsg;
            }
            else if (clubDriver.length == 0 && club7Iron.length == 0 && clubWedge.length == 0) {
                finalMsg = "Nothing to save...";
            }
            else
            {
                finalMsg = "Club data saved";
            }

            var yourElement = document.getElementById("btnSaveClubData");
            yourElement.setAttribute("data-content", finalMsg);

            // Check QS params in case we need to reload the scorecard to use new values
            queryParams = new URLSearchParams(window.location.search);
            queryCourse = queryParams.get('course');

            if (queryCourse != null) {
                loadScoreCard(queryCourse);
            }
        }

        function loadSearchDropdowns() {

            $.each(window.courseArr, function () {

                // Build course list
                var $courseButton = $('<button onclick="loadScoreCard(\'' + this.Name.replace("'", "\\'") + '\')" type="button" class="btn btn-outline btn-primary btn-lg btn-block courseButton" style="margin: 10px">' + this.Name + '</button>');
                $courseButton.appendTo($("#courseList"));

                //PAR
                if (this.Par) {
                    var parExists = ($('#ddlParSearch').find('option[value="' + this.Par + '"]').length != 0);

                    if (!parExists) {
                        $('#ddlParSearch').append($('<option></option>').val(this.Par).html(this.Par));
                    }
                }

                //TYPE
                if (this.Type) {
                    var typeExists = ($('#ddlTypeSearch').find('option[value="' + this.Type + '"]').length != 0);

                    if (!typeExists) {
                        $('#ddlTypeSearch').append($('<option></option>').val(this.Type).html(this.Type));
                    }
                }

                //CITY
                if (this.City && this.City.length > 0) {
                    var cityExists = ($('#ddlCitySearch').find('option[value="' + this.City + '"]').length != 0);

                    if (!cityExists) {
                        $('#ddlCitySearch').append($('<option></option>').val(this.City).html(this.City));
                    }
                }

                //COUNTRY
                if (this.Country && this.Country.length > 0) {
                    var countryExists = ($('#ddlCountrySearch').find('option[value="' + this.Country + '"]').length != 0);

                    if (!countryExists) {
                        $('#ddlCountrySearch').append($('<option></option>').val(this.Country).html(this.Country));
                    }
                }

                //CONTINENT
                if (this.Continent && this.Continent.length > 0) {
                    var continentExists = ($('#ddlContinentSearch').find('option[value="' + this.Continent + '"]').length != 0);

                    if (!continentExists) {
                        $('#ddlContinentSearch').append($('<option></option>').val(this.Continent).html(this.Continent));
                    }
                }

                //STATE
                if (this.State && this.State.length > 0) {
                    var stateExists = ($('#ddlStateSearch').find('option[value="' + this.State + '"]').length != 0);

                    if (!stateExists) {
                        $('#ddlStateSearch').append($('<option></option>').val(this.State).html(this.State));
                    }
                }
            });

            console.log('courses added...');

            // Sort Par list
            var pars = $("#ddlParSearch option");
            pars.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            pars.appendTo("#ddlParSearch");
            $("#ddlParSearch").val(''); // Select default blank value

            // Sort Type list
            var types = $("#ddlTypeSearch option");
            types.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            types.appendTo("#ddlTypeSearch");
            $("#ddlTypeSearch").val(''); // Select default blank value

            // Sort City list
            var cities = $("#ddlCitySearch option");
            cities.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            cities.appendTo("#ddlCitySearch");
            $("#ddlCitySearch").val(''); // Select default blank value

            // Sort Country list
            var countries = $("#ddlCountrySearch option");
            countries.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            countries.appendTo("#ddlCountrySearch");
            $("#ddlCountrySearch").val(''); // Select default blank value

            // Sort Continent list
            var continents = $("#ddlContinentSearch option");
            continents.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            continents.appendTo("#ddlContinentSearch");
            $("#ddlContinentSearch").val(''); // Select default blank value

            // Sort State list
            var states = $("#ddlStateSearch option");
            states.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            states.appendTo("#ddlStateSearch");
            $("#ddlStateSearch").val(''); // Select default blank value

            console.log('search dropdowns populated...');
        }

        function clipboardCopy() {
            var courseDiv = document.getElementById("courseName");
            var copyText = courseDiv.innerHTML;
            var path = window.location.href.split('?')[0]
            var shareURL = encodeURI(path + "?course=" + copyText);
            console.log("course URL copied to clipboard: " + shareURL);
            navigator.clipboard.writeText(shareURL);
        }

        function loadScoreCard(course) {
            try {
                // Reset the query string parameter if we already loaded a course and reset the search parameters
                var url = window.location.href;
                if (url.indexOf("?") > 0) {
                    var updatedUrl = url.substring(0, url.indexOf("?"));
                    window.history.replaceState({}, document.title, updatedUrl);
                }

                // Update page title to show current loaded course
                document.title = documentTitle + " - " + course;

                // Add/Update any QS params first if user clicks on a course to load
                var queryParams = new URLSearchParams(window.location.search);
                queryParams.set("course", course);
                window.history.replaceState({}, "", decodeURIComponent(`${window.location.pathname}?${queryParams}`));

                $("#course-placeholder").load(encodeURIComponent("fsx_play_courses/" + course + ".html"));

                var x = document.getElementById("courseFooter");

                if (x.style.display === "none") {
                    x.style.display = "block";
                }

                // Set Course Favorite Button
                var courseFav = LocalStorage('get', course + "_favorite");
                
                //console.log(course + " fav: " + courseFav);

                SetCourseFavoriteStar(courseFav);

                var y = document.getElementById("courseBuyLink");
                var z = document.getElementById("courseFlyoverLink");
                var zz = document.getElementById("courseRequestFlyover");
                var clubDataDiv = document.getElementById("clubDataAltAdj");
                var clubDriverBtn = document.getElementById("btnDriverAltAdj");
                var club7IronBtn = document.getElementById("btn7IronAltAdj");
                var clubWedgeBtn = document.getElementById("btnWedgeAltAdj");

                var clubDriver = LocalStorage('get', "clubData_Driver");
                var club7Iron = LocalStorage('get', "clubData_7Iron");
                var clubWedge = LocalStorage('get', "clubData_Wedge");

                clubDriverBtn.style.display = "none";
                club7IronBtn.style.display = "none";
                clubWedgeBtn.style.display = "none";

                //console.log("driver: " + clubDriver);
                //console.log("7i: " + club7Iron);
                //console.log("wedge: " + clubWedge);

                var courseAlt = window.courseArr.find(item => item.Name === course).Altitude;
                // Altitude(y) to % gain(x): 0.00002y=x
                altGain = (0.00002 * courseAlt);

                //console.log("course alt: " + courseAlt);

                var courseAltAdj = Math.round((altGain * 100));

                //console.log("course alt gain: " + courseAltAdj);

                if (courseAltAdj > 0) {
                    clubDataDiv.style.display = "table-cell";

                    $("#courseAltAdj").text(courseAltAdj + "%");

                    if (clubDriver != null || club7Iron != null || clubWedge != null) {

                        if (clubDriver != null) {
                            var newDriver = clubDriver;

                            try {
                                newDriver = Number(clubDriver);
                                newDriver = Math.round((newDriver * altGain) + newDriver);
                            }
                            catch (e) {
                                console.warn("error calculating driver altitude adjustment: " + e);
                            }

                            clubDriverBtn.style.display = "";
                            $("#clubDriverAltAdj").text(newDriver);
                        }

                        if (club7Iron != null) {
                            var new7Iron = club7Iron;

                            try {
                                new7Iron = Number(club7Iron);
                                new7Iron = Math.round((new7Iron * altGain) + new7Iron);
                            }
                            catch (e) {
                                console.warn("error calculating 7iron altitude adjustment: " + e);
                            }

                            club7IronBtn.style.display = "";
                            $("#club7IronAltAdj").text(new7Iron);
                        }

                        if (clubWedge != null) {
                            var newWedge = clubWedge;

                            try {
                                newWedge = Number(clubWedge);
                                newWedge = Math.round((newWedge * altGain) + newWedge);
                            }
                            catch (e) {
                                console.warn("error calculating wedge altitude adjustment: " + e);
                            }

                            clubWedgeBtn.style.display = "";
                            $("#clubWedgeAltAdj").text(newWedge);
                        }
                    }
                }
                else {
                    clubDataDiv.style.display = "none";
                }

                var matchingCourse = window.courseMediaArr.find(item => item.Name === course);
                //console.log("matchingCourse: " + matchingCourse);

                if (typeof matchingCourse !== 'undefined') {

                    //Check for Course Data link
                    if (matchingCourse.Data != null && matchingCourse.Data.length > 0) {
                        DownloadCourseData(course, matchingCourse.Data);
                    }
                    else {
                        // Reset the course background image
                        $('#course-placeholder').css('background-image', "");
                    }

                    //Check for Course Buy link
                    if (matchingCourse.Buy != null && matchingCourse.Buy.length > 0) {
                        y.style.display = "";
                        y.href = matchingCourse.Buy;
                    }
                    else {
                        y.style.display = "none";
                        y.href = "#";
                    }

                    //Check for Course Flyover link
                    if (matchingCourse.Flyover != null && matchingCourse.Flyover.length > 0) {
                        z.style.display = ""
                        z.href = matchingCourse.Flyover;

                        zz.style.display = "none";
                    }
                    else {
                        z.style.display = "none";
                        z.href = "#";

                        zz.style.display = "";
                    }
                }
                else {
                    // No media data found, so clean out links

                    y.style.display = "none";
                    y.href = "#";

                    z.style.display = "none";
                    z.href = "#";

                    zz.style.display = "none";
                }
            }
            catch (error) {
                console.warn(error);
            }
        }

        function DownloadCourseData(course, courseDataURL) {
            //console.log("download from: " + courseDataURL);

            var courseImage = SessionStorage('get', course + "_courseImg");

            if (courseImage == null) {

                $.getJSON(courseDataURL).done(function (data) {
                    courseImage = data.product.image.src + "&width=1500";
                    console.log("course downloaded image: " + courseImage);

                    // Update the course background image
                    $('#course-placeholder').css('background-image', "url(" + courseImage + ")");
                    $('#course-placeholder').css('background-size', "cover");

                    // Cache it for next time in the session
                    SessionStorage('set', course + "_courseImg", courseImage);
                }).fail(function (data) {
                    console.warn('course data could not be downloaded!');
                });
            }
            else {
                // Update the course background image
                $('#course-placeholder').css('background-image', "url(" + courseImage + ")");
                $('#course-placeholder').css('background-size', "cover");
            }
        }

        function unhideAllCourses() {
            document.querySelectorAll('.courseButton').forEach(function (el) {
                el.style.display = 'block';
            });

            $("#course-placeholder").empty();
        }

        function SearchCourseReset() {
            $("#txtNameSearch").val('');
            $("#ddlNameSearchOperator").val('Contains'); // Select default value
            $("#txtVersionSearch").val('');
            $("#ddlParSearch").val(''); // Select default blank value
            $("#txtSlopeSearch").val('');
            $("#ddlSlopeSearchOperator").val('>'); // Select default value
            $("#txtRatingSearch").val('');
            $("#ddlRatingSearchOperator").val('>'); // Select default value
            $("#txtYardageSearch").val('');
            $("#ddlYardageSearchOperator").val('>'); // Select default value
            $("#txtAltitudeSearch").val('');
            $("#ddlAltSearchOperator").val('>'); // Select default value
            $("#ddlCitySearch").val(''); // Select default blank value
            $("#ddlCountrySearch").val(''); // Select default blank value
            $("#ddlContinentSearch").val(''); // Select default blank value
            $("#ddlStateSearch").val(''); // Select default blank value
            $("#ddlTypeSearch").val(''); // Select default blank value

            $("#chkHasFlyoverVideo").prop("checked", false);
            $("#chkIsFavorite").prop("checked", false);

            unhideAllCourses();

            $("#courseResultCount").html("Courses found: " + window.courseArr.length);

            var x = document.getElementById("courseFooter");

            if (x.style.display === "block") {
                x.style.display = "none";
            }

            ResetURL();
        }

        function ResetURL() {
            // Reset the query string parameter if we already loaded a course and reset the search parameters
            var url = window.location.href;
            if (url.indexOf("?") > 0) {
                var updatedUrl = url.substring(0, url.indexOf("?"));
                window.history.replaceState({}, document.title, updatedUrl);
            }
        }

        function htmlDecode(input) {
            var e = document.createElement('textarea');
            e.innerHTML = input;
            return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
        }

        function LocalStorage(action, key, value) {

            // Code for localStorage/sessionStorage
            if (typeof (Storage) !== "undefined") {

                if (action === 'get') {
                    retVal = localStorage.getItem(key);
                    //console.log("localStorage " + action + ": " + key + "," + retVal);
                    return retVal;
                }
                else if (action === 'set') {
                    //console.log("localStorage " + action + ": " + key + "," + value);
                    localStorage.setItem(key, value);
                }
                else if (action === 'remove') {
                    //console.log("localStorage " + action + ": " + key);
                    localStorage.removeItem(key);
                }
            } else {
                // No Web Storage support...
                console.warn('No Web Storage support!');

                if (action === 'get') {
                    return null;
                }
            }
        }

        function SessionStorage(action, key, value) {

            // Code for localStorage/sessionStorage
            if (typeof (Storage) !== "undefined") {

                if (action === 'get') {
                    retVal = sessionStorage.getItem(key);
                    //console.log("sessionStorage " + action + ": " + key + "," + retVal);
                    return retVal;
                }
                else if (action === 'set') {
                    //console.log("sessionStorage " + action + ": " + key + "," + value);
                    sessionStorage.setItem(key, value);
                }
                else if (action === 'remove') {
                    //console.log("sessionStorage " + action + ": " + key);
                    sessionStorage.removeItem(key);
                }
            } else {
                // No Web Storage support...
                console.warn('No Web Storage support!');

                if (action === 'get') {
                    return null;
                }
            }
        }

        function MarkCourseFavorite() {
            var courseDiv = document.getElementById("courseName");
            var course = courseDiv.innerHTML;

            var fav = LocalStorage('get', course + "_favorite");

            //console.log("fav from storage: " + fav + " " + typeof fav);

            if (fav == null) {
                fav = true;
            }
            else if (fav === 'true') {
                fav = false;
            }
            else {
                fav = true;
            }

            //console.log(course + " new fav: " + fav);

            if (fav) {
                LocalStorage('set', course + "_favorite", fav);
            }
            else {
                LocalStorage('remove', course + "_favorite");
            }

            SetCourseFavoriteStar(fav);
        }

        function SetCourseFavoriteStar(fav) {
            if (fav === 'true' || fav === true) {
                $("#courseFavoriteStar").removeClass("fa-star-o");
                $("#courseFavoriteStar").addClass("fa-star");
            }
            else {
                $("#courseFavoriteStar").removeClass("fa-star");
                $("#courseFavoriteStar").addClass("fa-star-o");
            }
        }

        function requestFlyOverVideo() {
            var courseDiv = document.getElementById("courseName");
            var course = courseDiv.innerHTML;

            var hasSentCourseRequest = LocalStorage('get', course + "_requestedFlyover");

            //console.log("hasSentCourseRequest from storage: " + hasSentCourseRequest + " " + typeof hasSentCourseRequest);

            if (hasSentCourseRequest == null) {
                var msg = "Requesting a flyover video for: " + course;

                SendMessage(msg);

                console.log("Message sent - " + msg);

                LocalStorage('set', course + "_requestedFlyover", true);
            }
            else {
                console.log("A request has already sent for: " + course + " - Nothing to do...");
            }
        }

        function SendMessage(msg) {

            const request = new XMLHttpRequest();
            request.open("POST", "https://discord.com/api/webhooks/1253472184752410675/zf9b9C0dKCPc2JlmuopVRryFrD4YBCqYv4DIpbD4O6zg11K-Oi7pxwaeKpAP4xd8r9G2");

            request.setRequestHeader('Content-type', 'application/json');

            const params = {
                username: "Website User - " + window.userInfo,
                avatar_url: "https://lordscorpion60.github.io/images/homepage_og_img.png",
                content: msg
            }

            request.send(JSON.stringify(params));
        }

        function SearchCourse() {
            unhideAllCourses();
            ResetURL();

            var x = document.getElementById("courseFooter");

            if (x.style.display === "block") {
                x.style.display = "none";
            }

            // Texts
            var courseName = $("#txtNameSearch").val();
            var courseVersion = $("#txtVersionSearch").val();
            var courseAlt = $("#txtAltitudeSearch").val();
            var courseYardage = $("#txtYardageSearch").val();
            var courseSlope = $("#txtSlopeSearch").val();
            var courseRating = $("#txtRatingSearch").val();

            // DDLs
            var coursePar = $("#ddlParSearch").val();
            var courseType = $("#ddlTypeSearch").val();
            var courseCity = $("#ddlCitySearch").val();
            var courseCountry = $("#ddlCountrySearch").val();
            var courseContinent = $("#ddlContinentSearch").val();
            var courseState = $("#ddlStateSearch").val();

            // CHKs
            var courseHasFlyoverVideoIsChecked = $("#chkHasFlyoverVideo").prop("checked");
            var courseIsFavoriteIsChecked = $("#chkIsFavorite").prop("checked");

            // Check to see if we have any search parameters to actually do a search
            if (courseName.length > 0 || courseVersion.length > 0 || coursePar.length > 0 || courseType.length > 0 || courseAlt.length > 0 || courseCity.length > 0 || courseCountry.length > 0 || courseCountry.length > 0 || courseContinent.length > 0 || courseState.length > 0 || courseYardage.length > 0 || courseSlope.length > 0 || courseRating.length > 0 || courseHasFlyoverVideoIsChecked || courseIsFavoriteIsChecked) {
                var matches = window.courseArr.filter(function (course) {
                    // Name
                    if (courseName.length > 0) {
                        if ($("#ddlNameSearchOperator").val() == "Equals") {
                            return course.Name.toLowerCase() == courseName.toLowerCase();
                        }
                        else {
                            return course.Name.toLowerCase().includes(courseName.toLowerCase());
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Version
                    if (courseVersion.length > 0) {
                        return course.Version.startsWith(courseVersion);
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Par
                    if (coursePar.length > 0) {
                        return course.Par == coursePar;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Type
                    if (courseType.length > 0) {
                        return course.Type == courseType;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Altitude
                    if (courseAlt.length > 0) {
                        if ($("#ddlAltSearchOperator").val() == "=") {
                            return course.Altitude == courseAlt;
                        }
                        else if ($("#ddlAltSearchOperator").val() == ">") {
                            return course.Altitude > courseAlt;
                        }
                        else {
                            return course.Altitude < courseAlt;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // City
                    if (courseCity.length > 0) {
                        return course.City == courseCity;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Country
                    if (courseCountry.length > 0) {
                        return course.Country == courseCountry;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Continent
                    if (courseContinent.length > 0) {
                        return course.Continent == courseContinent;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // State
                    if (courseState.length > 0) {
                        return course.State == courseState;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Slope
                    if (courseSlope.length > 0) {
                        if ($("#ddlSlopeSearchOperator").val() == ">") {
                            return courseSlope < course.MaxSlope;
                        }
                        else {
                            return courseSlope > course.MinSlope;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Rating
                    if (courseRating.length > 0) {
                        if ($("#ddlRatingSearchOperator").val() == ">") {
                            return courseRating < course.MaxRating;
                        }
                        else {
                            return courseRating > course.MinRating;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Yardage
                    if (courseYardage.length > 0) {
                        if ($("#ddlYardageSearchOperator").val() == ">") {
                            return courseYardage < course.MaxYardage;
                        }
                        else {
                            return courseYardage > course.MinYardage;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Has Flyover Video
                    if (courseHasFlyoverVideoIsChecked) {
                        var matchingCourse = window.courseMediaArr.find(item => item.Name === course.Name);

                        if (typeof matchingCourse !== 'undefined') {
                            //Check for Course Flyover link
                            if (matchingCourse.Flyover != null && matchingCourse.Flyover.length > 0) {
                                //console.log("matching Media Course: " + matchingCourse.Name);
                                return course
                            }
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Is Favorite
                    if (courseIsFavoriteIsChecked) {
                        var matchingCourse = LocalStorage('get', course.Name + "_favorite");
                        
                        if (typeof matchingCourse !== 'undefined') {
                            if (matchingCourse != null && matchingCourse === 'true') {
                                return course
                            }
                        }
                    }
                    else {
                        return course;
                    }
                });

                var matchedCourses = [];
                $.each(matches, function () {
                    matchedCourses.push(this.Name);
                });

                $("#courseResultCount").html("Courses found: " + matchedCourses.length);

                if (matchedCourses.length > 0) {

                    document.querySelectorAll('.courseButton').forEach(function (el) {
                        if ($.inArray(htmlDecode(el.innerHTML), matchedCourses) == -1) {
                            el.style.display = 'none';
                        }
                    });

                    if (matchedCourses.length == 1) {
                        loadScoreCard(matchedCourses[0]);
                    }
                }
                else {
                    console.warn('nothing found in course search');
                    document.querySelectorAll('.courseButton').forEach(function (el) {
                        el.style.display = 'none';
                    });
                }
            }
        }
    </script>
</body>
</html>