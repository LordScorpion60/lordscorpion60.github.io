<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- HTML Meta Tags -->
    <title>LordScorpion60's Domain - FSX Play Scorecards</title>
    <meta name="description" content="">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://lordscorpion60.github.io/foresight_sports/fsx_play_courses.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="LordScorpion60's Domain - FSX Play Scorecards">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://ogcdn.net/6064b869-74ed-4eb9-b76c-0b701ffe7e6b/v4/lordscorpion60.github.io/%5B%20LordScorpion60's%20Domain%20%5D%20FSX%20Play%20Scorecards/https%3A%2F%2Fopengraph.b-cdn.net%2Fproduction%2Fimages%2Ffa506cf3-1f23-44d9-aa2a-12b830eeaa9d.jpg%3Ftoken%3DUTJ_Ar12acqND3QxxCIsz2b80IzxN2SHbkvjihBaWuo%26height%3D763%26width%3D1018%26expires%3D33253712874/og.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="lordscorpion60.github.io">
    <meta property="twitter:url" content="https://lordscorpion60.github.io/foresight_sports/fsx_play_courses.html">
    <meta name="twitter:title" content="LordScorpion60's Domain - FSX Play Scorecards">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://ogcdn.net/6064b869-74ed-4eb9-b76c-0b701ffe7e6b/v4/lordscorpion60.github.io/%5B%20LordScorpion60's%20Domain%20%5D%20FSX%20Play%20Scorecards/https%3A%2F%2Fopengraph.b-cdn.net%2Fproduction%2Fimages%2Ffa506cf3-1f23-44d9-aa2a-12b830eeaa9d.jpg%3Ftoken%3DUTJ_Ar12acqND3QxxCIsz2b80IzxN2SHbkvjihBaWuo%26height%3D763%26width%3D1018%26expires%3D33253712874/og.png">

    <!-- Meta Tags Generated via https://www.opengraph.xyz -->
    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <!--<link href="/css/plugins/metisMenu/metisMenu.min.css" rel="stylesheet">-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/metismenu/dist/metisMenu.min.css">

    <!-- Custom CSS -->
    <link href="/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
        div.sticky {
            position: -webkit-sticky; /* Safari */
            position: sticky;
            top: 10px;
            margin-top: 10px;
        }

        /* width */
        ::-webkit-scrollbar {
            width: 25px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #428bca;
            border-radius: 8px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: grey;
        }

        input[type='checkbox'] {
            width: 20px;
            height: 20px;
            background: white;
            vertical-align: middle;
            bottom: 3px;
            position: relative;
        }

        .btn-header {
            color: #31708f;
            background-color: #d9edf7;
            border: none;
            border-radius: 3px;
            transition: all .5s;
        }

        .btn-header:hover, .btn-header:focus, .btn-header:active, .btn-header.active, .open > .dropdown-toggle.btn-header {
            color: #fff;
            background-color: #428bca;
            border-color: #269abc
        }
    </style>
</head>

<body>
    <div id="wrapper">
        <!-- Navigation -->
        <div id="nav-placeholder">
            <!-- Leave blank so page content loads too -->
        </div>
        <!-- end of Navigation -->
        <!-- Page Content -->
        <div id="page-wrapper">
            <div class="row">
                <div class="col-xs-12">
                    <h1 class="page-header">FSX Play Scorecards</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel-group" id="accordion">
                        <div class="panel panel-danger" style="display:none">
                            <div class="panel-heading">
                                Disclaimer <i class="fa fa-exclamation-circle"></i>
                            </div>
                            <div class="panel-body">
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum tincidunt est vitae ultrices accumsan. Aliquam ornare lacus adipiscing, posuere lectus et, fringilla augue.</p>
                            </div>
                        </div>
                        <div class="panel panel-info">
                            <div class="btn btn-header btn-lg btn-block" data-toggle="collapse" data-parent="#accordionInfo" href="#collapseInfo">
                                <h4 class="panel-title" style="text-align: left;">
                                    Info <i class="fa fa-info-circle"></i>
                                </h4>
                            </div>
                            <div id="collapseInfo" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <p>The following is my repository of scorecards collected from each <a href="https://www.foresightsports.com/collections/fsx-courses" target="_blank">Foresight Sports FSX Play course <i class="fa fa-external-link fa-fw"></i></a> to provide specific search capabilities in order to learn more about the courses you own, are looking to buy, or want to share with a friend.</p>
                                    <p>Each scorecard will have a link to where you can purchase the course, some will have a link to watch a flyover video to learn more about how the course looks in FSX Play.</p>
                                    <p>Be sure to check the Notifications Panel on the <a href="/">home page</a> for updates and new features!</p>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-info">
                            <div class="btn btn-header btn-lg btn-block" data-toggle="collapse" data-parent="#accordionClub" href="#collapseClub">
                                <h4 class="panel-title" style="text-align: left;">
                                    Club Data <i class="fa fa-crosshairs"></i>
                                </h4>
                            </div>
                            <div id="collapseClub" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <p>Enter your carry for each club at sea level (0 ft.) and each selected course will show the adjusted carry for altitude.</p>
                                    <label style="text-align: center">
                                        Driver <input id="clubDataDriver" class="form-control" style="text-align: center; width: 75px;">
                                    </label>
                                    <label style="text-align: center">&nbsp;</label>
                                    <label style="text-align: center">
                                        7 Iron<input id="clubData7Iron" class="form-control" style="text-align: center; width: 75px;">
                                    </label>
                                    <label style="text-align: center">&nbsp;</label>
                                    <label style="text-align: center">
                                        Wedge<input id="clubDataWedge" class="form-control" style="text-align: center; width: 75px;">
                                    </label>
                                    &nbsp;&nbsp;<button id="btnSaveClubData" class="btn btn-info" type="button" data-container="body" data-toggle="popover" data-placement="right" data-content="Club data saved" onclick="saveClubData()">Save</button>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-info">
                            <div class="btn btn-header btn-lg btn-block" data-toggle="collapse" data-parent="#accordionSearch" href="#collapseSearch">
                                <h4 class="panel-title" style="text-align: left;">
                                    Course Search <i class="fa fa-search"></i>
                                </h4>
                            </div>
                            <div id="collapseSearch" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Course Name</span>
                                        <span class="input-group-btn" style="width: 105px;">
                                            <select class="form-control" id="ddlNameSearchOperator">
                                                <option>Contains</option>
                                                <option>Equals</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtNameSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Version</span>
                                        <input type="text" class="form-control" placeholder="" id="txtVersionSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Par</span>
                                        <select class="form-control" id="ddlParSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon tooltip-search">Slope <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="bottom" title="Has at least one teebox that has..."></i></span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlSlopeSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtSlopeSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon tooltip-search">Rating <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="bottom" title="Has at least one teebox that has..."></i></span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlRatingSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtRatingSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon tooltip-search">Yardage <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="bottom" title="Has at least one teebox that has..."></i></span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlYardageSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtYardageSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Altitude</span>
                                        <span class="input-group-btn" style="width: 60px;">
                                            <select class="form-control" id="ddlAltSearchOperator">
                                                <option>></option>
                                                <option><</option>
                                                <option>=</option>
                                            </select>
                                        </span>
                                        <input type="text" class="form-control" placeholder="" id="txtAltitudeSearch">
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Type</span>
                                        <select class="form-control" id="ddlTypeSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">City</span>
                                        <select class="form-control" id="ddlCitySearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Country</span>
                                        <select class="form-control" id="ddlCountrySearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">Continent</span>
                                        <select class="form-control" id="ddlContinentSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <span class="input-group-addon">State</span>
                                        <select class="form-control" id="ddlStateSearch">
                                            <option></option>
                                        </select>
                                    </div>
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            Has Flyover Video <input type="checkbox" id="chkHasFlyoverVideo">
                                        </div>
                                    </div>
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            Is Favorite <input type="checkbox" id="chkIsFavorite">
                                        </div>
                                    </div>
                                </div>
                                <div id="searchFooter" class="panel-footer small">
                                    <button id="btnSearchCourseName" class="btn btn-info" type="button" onclick="searchCourse()">
                                        Search
                                    </button>
                                    <button id="btnSearchCourseName" class="btn btn-warning" type="button" data-container="body" data-toggle="popover" data-placement="top" data-content="Search Filters Reset" onclick="searchCourseReset()">
                                        Reset
                                    </button>
                                    <button id="btnSearchShare" class="btn btn-outline btn-primary" data-container="body" data-toggle="popover" data-placement="top" data-content="" onclick="shareSearch()">
                                        Share Search <i class="fa fa-share-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-md-8">
                    <h4 id="courseResultCount">Courses loaded</h4>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-4 col-md-4" id="courseList" style="height: 900px; overflow-y: auto; overflow-x:hidden;">
                    <!-- Built on load -->
                </div>
                <div class="col-xs-8 col-md-8">
                    <div class="panel panel-primary" style="display: table; width:100%;">
                        <div class="panel-heading">
                            <i class="fa fa-arrow-left"></i> Click on a course to load it's scorecard here <i class="fa fa-arrow-down"></i>
                        </div>
                        <div class="panel-body" id="course_placeholder">
                            <!-- Leave blank so course content loads -->
                        </div>
                        <!-- Image Modal -->
                        <div class="modal fade" id="courseImageModal" tabindex="-1" role="dialog" aria-labelledby="courseImageModalTitle" aria-hidden="true">
                            <div class="modal-dialog" style="display: inline-block; width: auto; margin: 10px; display: flex; justify-content: center; text-align: center; ">
                                <div class="modal-content" style="">
                                    <div class="modal-header" style="padding: 5px;">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-right: 7px; margin-top:0px; font-size: 30px;">&times;</button>
                                        <h4 class="modal-title" id="courseImageModalTitle">Course Name</h4>
                                    </div>
                                    <div class="modal-body" data-dismiss="modal" style="padding: 0px;">
                                        <img id="courseImageModalFull" style="object-fit: contain; max-width: 100%;" />
                                    </div>                                    
                                </div>
                            </div>
                        </div>
                        <!-- /Modal -->
                        <div class="panel-footer" id="courseFooter" style="display:none">
                            <table width="100%">
                                <tr>
                                    <td align="left">
                                        <a class="btn btn-outline btn-primary" data-container="body" data-toggle="popover" data-placement="top" data-content="URL copied to clipboard" onclick="shareCourse()">
                                            Share Course <i class="fa fa-share-alt"></i>
                                        </a>
                                        <span class="tooltip-search">
                                            <button class="btn btn-outline btn-primary" id="courseFavorite" onclick="markCourseFavorite()" data-toggle="tooltip" data-placement="top" title="Choice will persist on your next visit">Favorite <i id="courseFavoriteStar" class="fa fa-star-o"></i></button>
                                        </span>
                                        <a class="btn btn-outline btn-primary" id="courseBuyLink" href="#" style="display:none" target="_blank">Buy Course <i class="fa fa-shopping-cart"></i></a>
                                        <a class="btn btn-outline btn-primary" id="courseFlyoverLink" href="#" style="display:none" target="_blank">Watch Flyover Video <i class="fa fa-video-camera"></i></a>
                                        <button class="btn btn-outline btn-primary" id="courseRequestFlyover" data-container="body" data-toggle="popover" data-placement="top" data-content="Request sent!" style="display:none" onclick="requestFlyOverVideo()">Request Flyover Video <i class="fa fa-bullhorn"></i></button>
                                    </td>
                                    <td align="right">
                                        <div style="display: none; vertical-align: middle;" id="clubDataAltAdj">
                                            &nbsp;<button type="button" id="btnAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8;"><b>Alt Gain:</b> <span id="courseAltAdj"></span></button>
                                            <button type="button" id="btnDriverAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8; display:none;"><b>D:</b> <span id="clubDriverAltAdj"></span></button>
                                            <button type="button" id="btn7IronAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8; display: none;"><b>7i:</b> <span id="club7IronAltAdj"></span></button>
                                            <button type="button" id="btnWedgeAltAdj" class="btn btn-info disabled" style="color: #000; opacity: .8; display: none;"><b>W:</b> <span id="clubWedgeAltAdj"></span></button>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /#wrapper -->
    <!-- jQuery Version 1.11.0 -->
    <script src="/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <!--<script src="/js/plugins/metisMenu/metisMenu.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/metismenu"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/sb-admin-2.js"></script>

    <script>

        // Variable to hold course information
        var documentTitle = document.title;
        var courseArr = {};
        var courseMediaArr = {};
        var userInfo = "[NO_IP]";
        var searchDataFound = false;
        var isDebug = false;

        $("[data-toggle=popover]").popover({
            delay: {
                show: 100,
                hide: 100
            }
        });

        $('.tooltip-search').tooltip({
            selector: "[data-toggle=tooltip]",
            container: "body"
        })

        $("[data-toggle=popover]").on('shown.bs.popover', function () {
            setTimeout(function (a) {
                a.popover('hide');
            }, 1500, $(this));
        });

        // Wire up keyboard enter key for course searching
        $("#txtNameSearch").on('keypress', function (event) {
            if (event.which === 13) {
                searchCourse();
            }
        });

        $("#txtVersionSearch").on('keypress', function (event) {
            if (event.which === 13) {
                searchCourse();
            }
        });

        $("#txtAltitudeSearch").on('keypress', function (event) {
            if (event.which === 13) {
                searchCourse();
            }
        });

        $("#txtSlopeSearch").on('keypress', function (event) {
            if (event.which === 13) {
                searchCourse();
            }
        });

        $("#txtRatingSearch").on('keypress', function (event) {
            if (event.which === 13) {
                searchCourse();
            }
        });

        $("#txtYardageSearch").on('keypress', function (event) {
            if (event.which === 13) {
                searchCourse();
            }
        });

        // On page-load.
        $(function () {
            SetDebugMode();

            $("#nav-placeholder").load("/nav.html");

            // Check QS params when page loads in case we got a course to load up
            const queryParams = new URLSearchParams(window.location.search);

            var queryCourse = queryParams.get('course');
            var querySearch = queryParams.get('search');

            Debug("query string course: " + queryCourse);

            var queryCourseAfterAmp = "";

            for (const key of queryParams.keys()) {
                if (key.startsWith(" ") && queryParams.get(key).length == 0) {
                    Debug("course query string w/ amp: '" + key + "'");
                    queryCourseAfterAmp = key;
                }
            }

            if (queryCourseAfterAmp.length > 0) {
                // We need to assume the course has an unescaped & in it and need to re-build the course name
                queryCourse += "&" + queryCourseAfterAmp;
                Debug("updated query string course: " + queryCourse);
            }

            // Read in json course data
            $.getJSON("/foresight_sports/fsx_play_courses/zz_allCourseData.json").done(function (data) {
                window.courseArr = data;

                Debug('course json loaded...');
                Debug(window.courseArr);

                if (window.courseArr.length > 0) {
                    LoadSearchDropdowns();
                    $("#courseResultCount").html("Courses found: " + window.courseArr.length);
                }

                // Restore any seach criteria if from refresh/reload
                if (window.performance) {
                    if (performance.navigation.type == performance.navigation.TYPE_RELOAD) {
                        // Page was reloaded - Restore any previous search criteria

                        var lastSearch = SessionStorage('get', 'lastSearch');

                        if (lastSearch != null) {
                            // Restore search criteria to each field on the page...
                            queryCourse = null;
                            PreloadSearchCriteria(lastSearch);
                        }
                        else {
                            Debug("no previous search found...");
                        }
                    } else {
                        // Page was not reloaded, so remove any last search criteria that might be cached
                        SessionStorage('remove', 'lastSearch');
                    }
                }
                else {
                    console.warn("Navigation Timing API is not supported on this browser!");
                }

                // Read in json course media data
                $.getJSON("/foresight_sports/fsx_play_courses/aa_allCourseMediaData.json").done(function (data) {
                    window.courseMediaArr = data;

                    Debug('course media json loaded...');

                    if (querySearch != null) {
                        Debug("search passed in via URL: " + querySearch);

                        try {
                            var searchString_dec = Base64_decode_url(querySearch);

                            Debug("decoded URL search string:" + searchString_dec);

                            // Restore search criteria to each field on the page...
                            PreloadSearchCriteria(searchString_dec);
                        }
                        catch (e) {
                            console.warn('could not parse search url parameter: ' + e);
                            ResetURL();
                        }
                    }
                    else if (queryCourse != null) {
                        loadScoreCard(queryCourse);
                    }
                    else {
                        // Remove all query string parameters just in case
                        Debug("no actions to take!");
                        ResetURL();
                    }
                }).done(function (data) {
                    if (window.searchDataFound) {
                        // Expand search criteria box
                        $('#collapseSearch').addClass('in');
                        // Re-run search
                        searchCourse();
                        window.searchDataFound = false;
                    }
                }).fail(function (data) {
                    console.warn('no course media data found!');
                });

            }).fail(function (data) {
                console.warn('no course data found!');
            });
            
            GetUserData();
            LoadClubData();
        });

        async function GetUserData() {
            try {
                var request1 = await fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        window.userInfo = "[" + data.ip + "]";

                        $.getJSON("https://ipinfo.io/json?token=e96ec5b44f0930").done(function (ipData) {
                            window.userInfo = "[" + ipData.ip + ":" + ipData.city + ":" + ipData.country + ":" + ipData.postal + "]";

                            Debug(ipData);
                        }).fail(function (data) {
                            Debug('no extra user data could be loaded!');
                        }).always(function (data) {
                            Debug(window.userInfo);
                        });
                    })
                    .catch(error => {
                        Debug('Error fetching IP:' + error);
                    });
            }
            catch (e) {
                Debug("could not get user IP: " + e);
            }
        }

        function PreloadSearchCriteria(searchData) {

            var searchArr = searchData.split('|');

            $.each(searchArr, function (index, value) {
                var searchField = value.split(';');
                var searchTerm = unEscapeURL(searchField[1]);

                // Name
                if (searchField[0] == ('courseName') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseName: ' + searchTerm + ' ' + searchField[2]);

                    $("#txtNameSearch").val(searchTerm);
                    $("#ddlNameSearchOperator").val(searchField[2]);
                }
                // Version
                if (searchField[0] == ('courseVersion') && searchTerm.length > 0) {
                    window.searchDataFound = true;
                    
                    Debug('courseVersion: ' + searchTerm);

                    $("#txtVersionSearch").val(searchTerm);
                }
                // Par
                if (searchField[0] == ('coursePar') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('coursePar: ' + searchTerm);

                    $("#ddlParSearch").val(searchTerm);
                }
                // Type
                if (searchField[0] == ('courseType') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseType: ' + searchTerm);

                    $("#ddlTypeSearch").val(searchTerm);
                }
                // Altitude
                if (searchField[0] == ('courseAlt') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseAlt: ' + searchTerm + ' ' + searchField[2]);

                    $("#txtAltitudeSearch").val(searchTerm);
                    $("#ddlAltSearchOperator").val(searchField[2]);
                }
                // City
                if (searchField[0] == ('courseCity') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseCity: ' + searchTerm);

                    $("#ddlCitySearch").val(searchTerm);
                }
                // Country
                if (searchField[0] == ('courseCountry') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseCountry: ' + searchTerm);

                    $("#ddlCountrySearch").val(searchTerm);
                }
                // Continent
                if (searchField[0] == ('courseContinent') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseContinent: ' + searchTerm);

                    $("#ddlContinentSearch").val(searchTerm);
                }
                // State
                if (searchField[0] == ('courseState') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseState: ' + searchTerm);

                    $("#ddlStateSearch").val(searchTerm);
                }
                // Slope
                if (searchField[0] == ('courseSlope') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseSlope: ' + searchTerm + ' ' + searchField[2]);

                    $("#txtSlopeSearch").val(searchTerm);
                    $("#ddlSlopeSearchOperator").val(searchField[2]);
                }
                // Rating
                if (searchField[0] == ('courseRating') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseRating: ' + searchTerm + ' ' + searchField[2]);

                    $("#txtRatingSearch").val(searchTerm);
                    $("#ddlRatingSearchOperator").val(searchField[2]);
                }
                // Yardage
                if (searchField[0] == ('courseYardage') && searchTerm.length > 0) {
                    window.searchDataFound = true;

                    Debug('courseYardage: ' + searchTerm + ' ' + searchField[2]);

                    $("#txtYardageSearch").val(searchTerm);
                    $("#ddlYardageSearchOperator").val(searchField[2]);
                }
                // Has Flyover Video
                if (searchField[0] == ('courseHasFlyoverVideoIsChecked')) {
                    window.searchDataFound = true;

                    Debug('courseHasFlyoverVideoIsChecked: ' + searchTerm);

                    $("#chkHasFlyoverVideo").prop("checked", searchTerm.toLowerCase() === "true");
                }
                // Is Favorite
                if (searchField[0] == ('courseIsFavoriteIsChecked')) {
                    window.searchDataFound = true;

                    Debug('courseIsFavoriteIsChecked: ' + searchTerm);

                    $("#chkIsFavorite").prop("checked", searchTerm.toLowerCase() === "true");
                }
            });
        }

        function LoadClubData() {
            var clubDriver = LocalStorage('get', "clubData_Driver");
            var club7Iron = LocalStorage('get', "clubData_7Iron");
            var clubWedge = LocalStorage('get', "clubData_Wedge");

            if (clubDriver != null) {
                $('#clubDataDriver').val(clubDriver);
            }

            if (club7Iron != null) {
                $('#clubData7Iron').val(club7Iron);
            }

            if (clubWedge != null) {
                $('#clubDataWedge').val(clubWedge);
            }
        }

        function saveClubData() {
            var clubDriver = $('#clubDataDriver').val();
            var club7Iron = $('#clubData7Iron').val();
            var clubWedge = $('#clubDataWedge').val();
            var errMsg = "";
            var finalMsg = "";

            var regex = /^[0-9]+$/;

            if (!clubDriver.match(regex) || Number(clubDriver) == 0 || Number(clubDriver) > 999) {
                if (clubDriver.length == 0) {
                    LocalStorage('remove', "clubData_Driver");
                }
                else {
                    errMsg = "Use a number (1-999) for Driver";
                }
            }
            else {
                LocalStorage('set', "clubData_Driver", clubDriver);
            }

            if (!club7Iron.match(regex) || Number(club7Iron) == 0 || Number(club7Iron) > 999) {
                if (club7Iron.length == 0) {
                    LocalStorage('remove', "clubData_7Iron");
                }
                else {
                    if (errMsg.length == 0) {
                        errMsg = "Use a number (1-999) for 7 Iron";
                    }
                    else {
                        errMsg += " & 7 Iron";
                    }
                }
            }
            else {
                LocalStorage('set', "clubData_7Iron", club7Iron);
            }

            if (!clubWedge.match(regex) || Number(clubWedge) == 0 || Number(clubWedge) > 999) {
                if (clubWedge.length == 0) {
                    LocalStorage('remove', "clubData_Wedge");
                }
                else {
                    if (errMsg.length == 0) {
                        errMsg = "Use a number (1-999) for Wedge";
                    }
                    else {
                        errMsg += " & Wedge";
                    }
                }
            }
            else {
                LocalStorage('set', "clubData_Wedge", clubWedge);
            }

            if (errMsg.length > 0) {
                finalMsg = errMsg;
            }
            else if (clubDriver.length == 0 && club7Iron.length == 0 && clubWedge.length == 0) {
                finalMsg = "Nothing to save...";
            }
            else
            {
                finalMsg = "Club data saved";
            }

            var yourElement = document.getElementById("btnSaveClubData");
            yourElement.setAttribute("data-content", finalMsg);

            // Check QS params in case we need to reload the scorecard to use new values
            queryParams = new URLSearchParams(window.location.search);
            queryCourse = queryParams.get('course');

            if (queryCourse != null) {
                loadScoreCard(queryCourse);
            }
        }

        function escapeHTML(str) {
            return str
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        function escapeURL(str) {
            return str
                .replaceAll(" ", "%20")
                .replaceAll("&", "%26")
                .replaceAll("<", "%3C")
                .replaceAll(">", "%3E")
                .replaceAll("\"", "%22")
                .replaceAll("'", "%27")
                .replaceAll(";", "%3B")
                .replaceAll("|", "%7C")
                .replaceAll(",", "%2C");
        }

        function unEscapeURL(str) {
            return str
                .replaceAll("%20", " ")
                .replaceAll("%26", "&")
                .replaceAll("%3C", "<")
                .replaceAll("%3E", ">")
                .replaceAll("%22", "\"")
                .replaceAll("%27", "'")
                .replaceAll("%3B", ";")
                .replaceAll("%7C", "|")
                .replaceAll("%2C", ",");
        }

        function LoadSearchDropdowns() {

            $.each(window.courseArr, function () {

                // Build course list
                var $courseButton = $('<button onclick="loadScoreCard(\'' + escapeHTML(this.Name.replace("'", "\\'")) + '\')" type="button" class="btn btn-outline btn-primary btn-lg btn-block courseButton" style="margin: 10px">' + this.Name + '</button>');
                $courseButton.appendTo($("#courseList"));

                //PAR
                if (this.Par) {
                    var parExists = ($('#ddlParSearch').find('option[value="' + this.Par + '"]').length != 0);

                    if (!parExists) {
                        $('#ddlParSearch').append($('<option></option>').val(this.Par).html(this.Par));
                    }
                }

                //TYPE
                if (this.Type) {
                    var typeExists = ($('#ddlTypeSearch').find('option[value="' + this.Type + '"]').length != 0);

                    if (!typeExists) {
                        $('#ddlTypeSearch').append($('<option></option>').val(this.Type).html(this.Type));
                    }
                }

                //CITY
                if (this.City && this.City.length > 0) {
                    var cityExists = ($('#ddlCitySearch').find('option[value="' + this.City + '"]').length != 0);

                    if (!cityExists) {
                        $('#ddlCitySearch').append($('<option></option>').val(this.City).html(this.City));
                    }
                }

                //COUNTRY
                if (this.Country && this.Country.length > 0) {
                    var countryExists = ($('#ddlCountrySearch').find('option[value="' + this.Country + '"]').length != 0);

                    if (!countryExists) {
                        $('#ddlCountrySearch').append($('<option></option>').val(this.Country).html(this.Country));
                    }
                }

                //CONTINENT
                if (this.Continent && this.Continent.length > 0) {
                    var continentExists = ($('#ddlContinentSearch').find('option[value="' + this.Continent + '"]').length != 0);

                    if (!continentExists) {
                        $('#ddlContinentSearch').append($('<option></option>').val(this.Continent).html(this.Continent));
                    }
                }

                //STATE
                if (this.State && this.State.length > 0) {
                    var stateExists = ($('#ddlStateSearch').find('option[value="' + this.State + '"]').length != 0);

                    if (!stateExists) {
                        $('#ddlStateSearch').append($('<option></option>').val(this.State).html(this.State));
                    }
                }
            });

            Debug('courses added...');

            // Sort Par list
            var pars = $("#ddlParSearch option");
            pars.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            pars.appendTo("#ddlParSearch");
            $("#ddlParSearch").val(''); // Select default blank value

            // Sort Type list
            var types = $("#ddlTypeSearch option");
            types.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            types.appendTo("#ddlTypeSearch");
            $("#ddlTypeSearch").val(''); // Select default blank value

            // Sort City list
            var cities = $("#ddlCitySearch option");
            cities.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            cities.appendTo("#ddlCitySearch");
            $("#ddlCitySearch").val(''); // Select default blank value

            // Sort Country list
            var countries = $("#ddlCountrySearch option");
            countries.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            countries.appendTo("#ddlCountrySearch");
            $("#ddlCountrySearch").val(''); // Select default blank value

            // Sort Continent list
            var continents = $("#ddlContinentSearch option");
            continents.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            continents.appendTo("#ddlContinentSearch");
            $("#ddlContinentSearch").val(''); // Select default blank value

            // Sort State list
            var states = $("#ddlStateSearch option");
            states.detach().sort(function (a, b) {
                var at = $(a).text();
                var bt = $(b).text();
                return (at > bt) ? 1 : ((at < bt) ? -1 : 0);
            });
            states.appendTo("#ddlStateSearch");
            $("#ddlStateSearch").val(''); // Select default blank value

            Debug('search dropdowns populated...');
        }

        function shareCourse() {
            var courseDiv = document.getElementById("courseName");
            var copyText = courseDiv.innerText;

            var path = window.location.href.split('?')[0]
            var shareURL = path + "?course=" + escapeURL(copyText);

            SendToClipboard(shareURL);
        }

        function shareSearch() {
            var searchCriteria = GetSearchCriteria();
            var yourElement = document.getElementById("btnSearchShare");
            var finalMsg = "URL copied to clipboard";

            if (searchCriteria.hasData) {
                Debug("search criteria to share: " + searchCriteria.searchString);

                try {
                    var searchString_enc = Base64_encode_url(searchCriteria.searchString);

                    var path = window.location.href.split('?')[0]
                    var shareURL = path + "?search=" + escapeURL(searchString_enc);

                    SendToClipboard(shareURL);
                }
                catch (e) {
                    finalMsg = "Error sharing URL!"
                    console.warn(finalMsg + "-" + e);
                }
            }
            else {
                finalMsg = "No search criteria to share!";
            }

            yourElement.setAttribute("data-content", finalMsg);
        }

        function SendToClipboard(str) {
            try {
                navigator.clipboard.writeText(str);

                Debug("data copied to clipboard: " + str);
            }
            catch (e) {
                console.warn("error copying data (" + str + ") to clipboard: " + e);
            }
        }

        function ResetURL() {
            var url = window.location.href;

            if (url.indexOf("?") > 0) {
                var updatedUrl = url.substring(0, url.indexOf("?"));
                window.history.replaceState({}, document.title, updatedUrl);
            }
        }

        function loadScoreCard(course) {
            try {
                Debug("Trying to load scorecard for course: " + course);

                // Make sure the course is the full proper name of the course and update incase a partial url was passed in (YT kill's courses ended in ')')
                var matchedCourses = window.courseArr.filter(function (a) { return (a.Name.toLowerCase() == course.toLowerCase()) });

                if (matchedCourses == 0) {
                    Debug("course not an exact match...");
                    // Not an exact match, so check for partial matches...
                    matchedCourses = window.courseArr.filter(function (a) { return (a.Name.toLowerCase().includes(course.toLowerCase())) });
                }
                else {
                    // Exact match, just check for improper cased course name
                    if (course != matchedCourses[0].Name) {
                        Debug("passed in course name is not correct case. Updating...");
                        course = matchedCourses[0].Name;
                    }
                }

                var matchCourseCount = matchedCourses.length;
                Debug("matched courses: " + matchCourseCount);

                if (matchCourseCount == 1) {
                    // Partial match is unique, change the course name to be correct and proceed
                    if (course.toLowerCase() != matchedCourses[0].Name.toLowerCase()) {
                        Debug("passed in course name is incorrect. Updating...");
                        course = matchedCourses[0].Name;
                    }
                }

                if (matchCourseCount != 1) {
                    // Too many courses match the passed in course name, so we need to redirect to a course name search...
                    Debug("No direct course match, loading search instead...");

                    var newSearch = "courseName;" + course + ";Contains";

                    PreloadSearchCriteria(newSearch);
                    // Expand search criteria box
                    $('#collapseSearch').addClass('in');
                    // Run search
                    searchCourse();
                }
                else {
                    Debug("load scorecard: " + course);

                    // Reset the query string parameter if we already loaded a course and reset the search parameters
                    ResetURL();

                    // Update page title to show current loaded course
                    document.title = documentTitle + " - " + course;

                    // Add/Update any QS params first if user clicks on a course to load
                    var queryParams = new URLSearchParams(window.location.search);
                    queryParams.set("course", escapeURL(course));
                    Debug("url param set: " + escapeURL(course));
                    window.history.replaceState({}, "", decodeURIComponent(`${window.location.pathname}?${queryParams}`));

                    $("#course_placeholder").load(encodeURIComponent("fsx_play_courses/" + course + ".html"), function () {

                        $('table').css('cursor', 'default');

                        var courseHoleImage = course.replaceAll(" ", "_") + "$##HOLE##_.png";

                        $('#courseHolesTable tr td:first-child').each(function () {
                            $(this).on("click", function () {
                                var holeNo = $(this)[0].innerText;
                                $('#courseImageModalTitle').text(course + ' - Hole: ' + holeNo);

                                var courseHoleImageURL = encodeURIComponent("fsx_play_course_images/" + courseHoleImage.replace("##HOLE##", holeNo)).replace("(", "%28").replace(")", "%29").replace("'", "%27");
                                $("#courseImageModalFull").attr("src", courseHoleImageURL);
                            })

                            $(this).css('cursor', 'zoom-in');
                            $(this).css('text-decoration', 'underline');
                            $(this).css('text-decoration', 'underline');

                            var oldBGColor = $(this).css("background-color");

                            $(this).on('mouseenter', function () {
                                $(this).css("background-color", "#428bca");
                                $(this).css('text-decoration', 'none');
                            }).on('mouseleave', function () {
                                $(this).css("background-color", oldBGColor);
                                $(this).css('text-decoration', 'underline');
                            })
                        })
                    });

                    var x = document.getElementById("courseFooter");

                    if (x.style.display === "none") {
                        x.style.display = "block";
                    }

                    // Set Course Favorite Button
                    var courseFav = LocalStorage('get', course + "_favorite");

                    Debug(course + " fav: " + courseFav);

                    SetCourseFavoriteStar(courseFav);

                    var y = document.getElementById("courseBuyLink");
                    var z = document.getElementById("courseFlyoverLink");
                    var zz = document.getElementById("courseRequestFlyover");
                    var clubDataDiv = document.getElementById("clubDataAltAdj");
                    var clubDriverBtn = document.getElementById("btnDriverAltAdj");
                    var club7IronBtn = document.getElementById("btn7IronAltAdj");
                    var clubWedgeBtn = document.getElementById("btnWedgeAltAdj");

                    var clubDriver = LocalStorage('get', "clubData_Driver");
                    var club7Iron = LocalStorage('get', "clubData_7Iron");
                    var clubWedge = LocalStorage('get', "clubData_Wedge");

                    clubDriverBtn.style.display = "none";
                    club7IronBtn.style.display = "none";
                    clubWedgeBtn.style.display = "none";

                    Debug("driver: " + clubDriver);
                    Debug("7i: " + club7Iron);
                    Debug("wedge: " + clubWedge);

                    var courseAlt = window.courseArr.find(item => item.Name === course).Altitude;
                    // Altitude(y) to % gain(x): 0.00002y=x
                    altGain = (0.00002 * courseAlt);

                    Debug("course alt: " + courseAlt);

                    var courseAltAdj = Math.round((altGain * 100));

                    Debug("course alt gain: " + courseAltAdj);

                    if (courseAltAdj > 0) {
                        clubDataDiv.style.display = "table-cell";

                        $("#courseAltAdj").text(courseAltAdj + "%");

                        if (clubDriver != null || club7Iron != null || clubWedge != null) {

                            if (clubDriver != null) {
                                var newDriver = clubDriver;

                                try {
                                    newDriver = Number(clubDriver);
                                    newDriver = Math.round((newDriver * altGain) + newDriver);
                                }
                                catch (e) {
                                    console.warn("error calculating driver altitude adjustment: " + e);
                                }

                                clubDriverBtn.style.display = "";
                                $("#clubDriverAltAdj").text(newDriver);
                            }

                            if (club7Iron != null) {
                                var new7Iron = club7Iron;

                                try {
                                    new7Iron = Number(club7Iron);
                                    new7Iron = Math.round((new7Iron * altGain) + new7Iron);
                                }
                                catch (e) {
                                    console.warn("error calculating 7iron altitude adjustment: " + e);
                                }

                                club7IronBtn.style.display = "";
                                $("#club7IronAltAdj").text(new7Iron);
                            }

                            if (clubWedge != null) {
                                var newWedge = clubWedge;

                                try {
                                    newWedge = Number(clubWedge);
                                    newWedge = Math.round((newWedge * altGain) + newWedge);
                                }
                                catch (e) {
                                    console.warn("error calculating wedge altitude adjustment: " + e);
                                }

                                clubWedgeBtn.style.display = "";
                                $("#clubWedgeAltAdj").text(newWedge);
                            }
                        }
                    }
                    else {
                        clubDataDiv.style.display = "none";
                    }

                    // Update the course background image
                    UpdateCourseModal(course);

                    var matchingCourse = window.courseMediaArr.find(item => item.Name === course);

                    Debug("matchingCourse: " + JSON.stringify(matchingCourse));

                    if (typeof matchingCourse !== 'undefined') {

                        //Check for Course Buy link
                        if (matchingCourse.Buy != null && matchingCourse.Buy.length > 0) {
                            y.style.display = "";
                            y.href = matchingCourse.Buy;
                        }
                        else {
                            y.style.display = "none";
                            y.href = "#";
                        }

                        //Check for Course Flyover link
                        if (matchingCourse.Flyover != null && matchingCourse.Flyover.length > 0) {
                            z.style.display = ""
                            z.href = matchingCourse.Flyover;

                            zz.style.display = "none";
                        }
                        else {
                            z.style.display = "none";
                            z.href = "#";

                            zz.style.display = "";
                        }
                    }
                    else {
                        // No media data found, so clean out links

                        y.style.display = "none";
                        y.href = "#";

                        z.style.display = "none";
                        z.href = "#";

                        zz.style.display = "none";
                    }
                }
            }
            catch (error) {
                console.error("error loading scorecard: ", error);
            }
        }

        function UpdateCourseModal(course) {
            var courseImage = course.replaceAll(" ", "_") + "_.png";
            var courseImageURL = encodeURIComponent("fsx_play_course_images/" + courseImage).replace("(", "%28").replace(")", "%29").replace("'", "%27");

            Debug(course);
            Debug(courseImage);
            Debug(courseImageURL);

            $('#course_placeholder').css('background-image', "url(" + courseImageURL + ")");
            $('#course_placeholder').css('background-size', "cover");
            $('#course_placeholder').css('cursor', 'zoom-in');            
            $('#course_placeholder').on("click", function (e) {
                var senderElement = e.target;
                // Clear modal
                $('#course_placeholder').attr('data-target', '');
                $('#course_placeholder').attr('data-toggle', '');

                // Check if sender is the parent placeholder <div> element
                if ($(e.target).is("div")) {
                    Debug('course_placeholder - clicked');
                    $('#courseImageModalTitle').text(course);
                    $("#courseImageModalFull").attr("src", courseImageURL);
                    $('#course_placeholder').attr('data-target', '#courseImageModal');
                    $('#course_placeholder').attr('data-toggle', 'modal');
                }
                else if ($(e.target).is("td") && e.target.style.cursor == 'zoom-in') {
                    Debug('course_hole - clicked');
                    $('#course_placeholder').attr('data-target', '#courseImageModal');
                    $('#course_placeholder').attr('data-toggle', 'modal');
                }
                return true;
            })
        }

        function RemoveCourseModal() {
            $('#course_placeholder').css('background-image', "");
            $('#course_placeholder').attr('data-target', '');
            $('#course_placeholder').attr('data-toggle', '');
            $('#courseImageModalTitle').text('Course Name');
            $('#course_placeholder').css('cursor', '');
        }

        function UnhideAllCourses() {
            // Reset the course background image
            RemoveCourseModal();

            document.querySelectorAll('.courseButton').forEach(function (el) {
                el.style.display = 'block';
            });

            $("#course_placeholder").empty();
        }

        function searchCourseReset() {
            SessionStorage('remove', 'lastSearch');

            $("#txtNameSearch").val('');
            $("#ddlNameSearchOperator").val('Contains'); // Select default value
            $("#txtVersionSearch").val('');
            $("#ddlParSearch").val(''); // Select default blank value
            $("#txtSlopeSearch").val('');
            $("#ddlSlopeSearchOperator").val('>'); // Select default value
            $("#txtRatingSearch").val('');
            $("#ddlRatingSearchOperator").val('>'); // Select default value
            $("#txtYardageSearch").val('');
            $("#ddlYardageSearchOperator").val('>'); // Select default value
            $("#txtAltitudeSearch").val('');
            $("#ddlAltSearchOperator").val('>'); // Select default value
            $("#ddlCitySearch").val(''); // Select default blank value
            $("#ddlCountrySearch").val(''); // Select default blank value
            $("#ddlContinentSearch").val(''); // Select default blank value
            $("#ddlStateSearch").val(''); // Select default blank value
            $("#ddlTypeSearch").val(''); // Select default blank value

            $("#chkHasFlyoverVideo").prop("checked", false);
            $("#chkIsFavorite").prop("checked", false);

            UnhideAllCourses();

            $("#courseResultCount").html("Courses found: " + window.courseArr.length);

            var x = document.getElementById("courseFooter");

            if (x.style.display === "block") {
                x.style.display = "none";
            }

            ResetURL();
        }

        function ResetURL() {
            // Reset the query string parameter if we already loaded a course and reset the search parameters
            var url = window.location.href;
            if (url.indexOf("?") > 0) {
                var updatedUrl = url.substring(0, url.indexOf("?"));
                window.history.replaceState({}, document.title, updatedUrl);
            }
        }

        function HtmlDecode(input) {
            var e = document.createElement('textarea');
            e.innerHTML = input;
            return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
        }

        function LocalStorage(action, key, value) {

            // Code for localStorage/sessionStorage
            if (typeof (Storage) !== "undefined") {

                if (action === 'get') {
                    retVal = localStorage.getItem(key);

                    Debug("localStorage " + action + ": " + key + "," + retVal);

                    return retVal;
                }
                else if (action === 'set') {
                    localStorage.setItem(key, value);

                    Debug("localStorage " + action + ": " + key + "," + value);
                }
                else if (action === 'remove') {
                    localStorage.removeItem(key);

                    Debug("localStorage " + action + ": " + key);
                }
            } else {
                // No Web Storage support...
                console.warn('No Web Storage support!');

                if (action === 'get') {
                    return null;
                }
            }
        }

        function SessionStorage(action, key, value) {

            // Code for localStorage/sessionStorage
            if (typeof (Storage) !== "undefined") {

                if (action === 'get') {
                    retVal = sessionStorage.getItem(key);

                    Debug("sessionStorage " + action + ": " + key + "," + retVal);

                    return retVal;
                }
                else if (action === 'set') {
                    sessionStorage.setItem(key, value);

                    Debug("sessionStorage " + action + ": " + key + "," + value);
                }
                else if (action === 'remove') {
                    sessionStorage.removeItem(key);

                    Debug("sessionStorage " + action + ": " + key);
                }
            } else {
                // No Web Storage support...
                console.warn('No Web Storage support!');

                if (action === 'get') {
                    return null;
                }
            }
        }

        function markCourseFavorite() {
            var courseDiv = document.getElementById("courseName");
            var course = courseDiv.innerText;

            var fav = LocalStorage('get', course + "_favorite");

            Debug("fav from storage: " + fav + " " + typeof fav);

            if (fav == null) {
                fav = true;
            }
            else if (fav === 'true') {
                fav = false;
            }
            else {
                fav = true;
            }

            Debug(course + " new fav: " + fav);

            if (fav) {
                LocalStorage('set', course + "_favorite", fav);
            }
            else {
                LocalStorage('remove', course + "_favorite");
            }

            SetCourseFavoriteStar(fav);
        }

        function SetCourseFavoriteStar(fav) {
            if (fav === 'true' || fav === true) {
                $("#courseFavoriteStar").removeClass("fa-star-o");
                $("#courseFavoriteStar").addClass("fa-star");
            }
            else {
                $("#courseFavoriteStar").removeClass("fa-star");
                $("#courseFavoriteStar").addClass("fa-star-o");
            }
        }

        function requestFlyOverVideo() {
            var courseDiv = document.getElementById("courseName");
            var course = courseDiv.innerText;

            var hasSentCourseRequest = LocalStorage('get', course + "_requestedFlyover");

            Debug("hasSentCourseRequest from storage: " + hasSentCourseRequest + " " + typeof hasSentCourseRequest);

            if (hasSentCourseRequest == null) {
                var msg = "Requesting a flyover video for: " + course;

                SendMessage(msg);

                Debug("Message sent - " + msg);

                LocalStorage('set', course + "_requestedFlyover", true);
            }
            else {
                Debug("A request has already sent for: " + course + " - Nothing to do...");
            }
        }

        function SendMessage(msg) {

            const request = new XMLHttpRequest();
            request.open("POST", "https://discord.com/api/webhooks/1253472184752410675/zf9b9C0dKCPc2JlmuopVRryFrD4YBCqYv4DIpbD4O6zg11K-Oi7pxwaeKpAP4xd8r9G2");

            request.setRequestHeader('Content-type', 'application/json');

            const params = {
                username: "Website User - " + window.userInfo,
                avatar_url: "https://lordscorpion60.github.io/images/homepage_og_img.png",
                content: msg
            }

            request.send(JSON.stringify(params));
        }

        function Base64_encode_url(s) {
            var str = window.btoa(unescape(encodeURIComponent(s)));
            return str.replace(/\+/g, '-').replace(/\//g, '_');
        }

        function Base64_decode_url(s) {
            var str = s, str_pad = (str + '===');
            str = str_pad.slice(0, str.length + (str.length % 4));
            str = str.replace(/-/g, '+').replace(/_/g, '/');
            return decodeURIComponent(escape(window.atob(str)));
        }

        function SetDebugMode() {
            var dbgKey = SessionStorage('get', 'debug');

            window.isDebug = (dbgKey != null && dbgKey.toLowerCase() === 'true');

            console.info("debug mode:" + window.isDebug);
        }

        function Debug(msg) {
            if (window.isDebug) {
                console.log(msg);
            }
        }

        function GetSearchCriteria() {
            // Texts
            var courseName = $("#txtNameSearch").val();
            var courseVersion = $("#txtVersionSearch").val();
            var courseAlt = $("#txtAltitudeSearch").val();
            var courseYardage = $("#txtYardageSearch").val();
            var courseSlope = $("#txtSlopeSearch").val();
            var courseRating = $("#txtRatingSearch").val();

            // DDLs
            var coursePar = $("#ddlParSearch").val();
            var courseType = $("#ddlTypeSearch").val();
            var courseCity = $("#ddlCitySearch").val();
            var courseCountry = $("#ddlCountrySearch").val();
            var courseContinent = $("#ddlContinentSearch").val();
            var courseState = $("#ddlStateSearch").val();

            // CHKs
            var courseHasFlyoverVideoIsChecked = $("#chkHasFlyoverVideo").prop("checked");
            var courseIsFavoriteIsChecked = $("#chkIsFavorite").prop("checked");

            // Operators
            var courseNameSearchOperator = $("#ddlNameSearchOperator").val();
            var courseAltSearchOperator = $("#ddlAltSearchOperator").val();
            var courseSlopeSearchOperator = $("#ddlSlopeSearchOperator").val();
            var courseRatingSearchOperator = $("#ddlRatingSearchOperator").val();
            var courseYardageSearchOperator = $("#ddlYardageSearchOperator").val();

            var obj = new Object();

            obj.courseName = courseName;
            obj.courseVersion = courseVersion;
            obj.courseAlt = courseAlt;
            obj.courseYardage = courseYardage;
            obj.courseSlope = courseSlope;
            obj.courseRating = courseRating;
            obj.coursePar = coursePar;
            obj.courseType = courseType;
            obj.courseCity = courseCity;
            obj.courseCountry = courseCountry;
            obj.courseContinent = courseContinent;
            obj.courseState = courseState;
            obj.courseHasFlyoverVideoIsChecked = courseHasFlyoverVideoIsChecked;
            obj.courseIsFavoriteIsChecked = courseIsFavoriteIsChecked;
            obj.courseNameSearchOperator = courseNameSearchOperator;
            obj.courseAltSearchOperator = courseAltSearchOperator;
            obj.courseSlopeSearchOperator = courseSlopeSearchOperator;
            obj.courseRatingSearchOperator = courseRatingSearchOperator;
            obj.courseYardageSearchOperator = courseYardageSearchOperator;

            let count = 0;

            for (const key of Object.keys(obj)) {
                var value = obj[key];

                if (!key.endsWith("SearchOperator") && value.length > 0) {
                    count++;
                    Debug("search term - " + key + " : " + value);
                }
                else if (key.endsWith("IsChecked") && value) {
                    count++;
                    Debug("search check box - " + key + " : " + value);
                }
            }

            Debug("search parameter count: " + count);

            if (count == 0) {
                obj.hasData = false;
            }
            else {
                obj.hasData = true;
            }

            obj.searchString = "courseName;" + escapeURL(obj.courseName) + ";" + obj.courseNameSearchOperator + "|courseVersion;" + escapeURL(obj.courseVersion) + "|coursePar;" + obj.coursePar + "|courseType;" + obj.courseType + "|courseAlt;" + escapeURL(obj.courseAlt) + ";" + obj.courseAltSearchOperator + "|courseCity;" + obj.courseCity + "|courseCountry;" + obj.courseCountry + "|courseContinent;" + obj.courseContinent + "|courseState;" + obj.courseState + "|courseYardage;" + escapeURL(obj.courseYardage) + ";" + obj.courseYardageSearchOperator + "|courseSlope;" + escapeURL(obj.courseSlope) + ";" + obj.courseSlopeSearchOperator + "|courseRating;" + escapeURL(obj.courseRating) + ";" + obj.courseRatingSearchOperator + "|courseHasFlyoverVideoIsChecked;" + obj.courseHasFlyoverVideoIsChecked + "|courseIsFavoriteIsChecked;" + obj.courseIsFavoriteIsChecked;

            Debug("has search data: " + obj.hasData);

            return obj;
        }

        function searchCourse() {
            UnhideAllCourses();
            ResetURL();

            var x = document.getElementById("courseFooter");

            if (x.style.display === "block") {
                x.style.display = "none";
            }

            var searchCriteria = GetSearchCriteria();

            // Check to see if we have any search parameters to actually do a search
            if (searchCriteria.hasData) {
                // Store search criteria for page refresh/reload
                SessionStorage("set", "lastSearch", searchCriteria.searchString);

                // Perform search
                var matches = window.courseArr.filter(function (course) {
                    // Name
                    if (searchCriteria.courseName.length > 0) {
                        if (searchCriteria.courseNameSearchOperator == "Equals") {
                            return course.Name.toLowerCase() == searchCriteria.courseName.toLowerCase();
                        }
                        else {
                            return course.Name.toLowerCase().includes(searchCriteria.courseName.toLowerCase());
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Version
                    if (searchCriteria.courseVersion.length > 0) {
                        return course.Version.startsWith(searchCriteria.courseVersion);
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Par
                    if (searchCriteria.coursePar.length > 0) {
                        return course.Par == searchCriteria.coursePar;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Type
                    if (searchCriteria.courseType.length > 0) {
                        return course.Type == searchCriteria.courseType;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Altitude
                    if (searchCriteria.courseAlt.length > 0) {
                        if (searchCriteria.courseAltSearchOperator == "=") {
                            return course.Altitude == searchCriteria.courseAlt;
                        }
                        else if (searchCriteria.courseAltSearchOperator == ">") {
                            return course.Altitude > searchCriteria.courseAlt;
                        }
                        else {
                            return course.Altitude < searchCriteria.courseAlt;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // City
                    if (searchCriteria.courseCity.length > 0) {
                        return course.City == searchCriteria.courseCity;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Country
                    if (searchCriteria.courseCountry.length > 0) {
                        return course.Country == searchCriteria.courseCountry;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Continent
                    if (searchCriteria.courseContinent.length > 0) {
                        return course.Continent == searchCriteria.courseContinent;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // State
                    if (searchCriteria.courseState.length > 0) {
                        return course.State == searchCriteria.courseState;
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Slope
                    if (searchCriteria.courseSlope.length > 0) {
                        if (searchCriteria.courseSlopeSearchOperator == ">") {
                            return searchCriteria.courseSlope < course.MaxSlope;
                        }
                        else {
                            return searchCriteria.courseSlope > course.MinSlope;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Rating
                    if (searchCriteria.courseRating.length > 0) {
                        if (searchCriteria.courseRatingSearchOperator == ">") {
                            return searchCriteria.courseRating < course.MaxRating;
                        }
                        else {
                            return searchCriteria.courseRating > course.MinRating;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Yardage
                    if (searchCriteria.courseYardage.length > 0) {
                        if (searchCriteria.courseYardageSearchOperator == ">") {
                            return searchCriteria.courseYardage < course.MaxYardage;
                        }
                        else {
                            return searchCriteria.courseYardage > course.MinYardage;
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Has Flyover Video
                    if (searchCriteria.courseHasFlyoverVideoIsChecked) {
                        var matchingCourse = window.courseMediaArr.find(item => item.Name === course.Name);

                        if (typeof matchingCourse !== 'undefined') {
                            //Check for Course Flyover link
                            if (matchingCourse.Flyover != null && matchingCourse.Flyover.length > 0) {
                                Debug("matching Media Course: " + matchingCourse.Name);

                                return course
                            }
                        }
                    }
                    else {
                        return course;
                    }
                }).filter(function (course) {
                    // Is Favorite
                    if (searchCriteria.courseIsFavoriteIsChecked) {
                        var matchingCourse = LocalStorage('get', course.Name + "_favorite");
                        
                        if (typeof matchingCourse !== 'undefined') {
                            if (matchingCourse != null && matchingCourse === 'true') {
                                return course
                            }
                        }
                    }
                    else {
                        return course;
                    }
                });

                var matchedCourses = [];
                $.each(matches, function () {
                    matchedCourses.push(this.Name);
                });

                $("#courseResultCount").html("Courses found: " + matchedCourses.length);

                if (matchedCourses.length > 0) {

                    document.querySelectorAll('.courseButton').forEach(function (el) {
                        if ($.inArray(HtmlDecode(el.innerHTML), matchedCourses) == -1) {
                            el.style.display = 'none';
                        }
                    });

                    if (matchedCourses.length == 1) {
                        loadScoreCard(matchedCourses[0]);
                    }
                }
                else {
                    Debug('nothing found in course search...');
                    document.querySelectorAll('.courseButton').forEach(function (el) {
                        el.style.display = 'none';
                    });
                }
            }

            var result = document.getElementById("searchFooter");
            result.scrollIntoView();
        }
    </script>
</body>
</html>